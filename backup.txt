CREATE TABLE Airline_info (
	airline_id INT PRIMARY KEY,
	airline_code VARCHAR(30) NOT NULL UNIQUE,
	airline_name VARCHAR(50) NOT NULL,
	airline_country VARCHAR(50) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL,
	info VARCHAR(50)
	
);

ALTER TABLE Airline_info RENAME TO Airline;
ALTER TABLE Airline DROP COLUMN info;

ALTER TABLE Airline
ADD CONSTRAINT unique_name UNIQUE (airline_name);

CREATE TABLE Airport (
	airport_id INT PRIMARY KEY,
	airport_name VARCHAR(50) NOT NULL UNIQUE,
	country VARCHAR(50) NOT NULL,
	state VARCHAR(50) NOT NULL,
	city VARCHAR(50) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL
	
);

CREATE TABLE Baggage_check (
	baggage_check_id INT PRIMARY KEY,
	passenger_id INT, -- FK
	check_result  VARCHAR(50),
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL
	
);

ALTER TABLE Baggage_check
ALTER COLUMN check_result SET NOT NULL;

ALTER TABLE Baggage_check
ADD COLUMN booking_id INT;

CREATE TABLE Baggage (
	baggage_id INT PRIMARY KEY,
	booking_id INT, -- FK
	weight_in_kg DECIMAL(4,2) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL
	
);

CREATE TABLE Boarding_pass (
	boarding_pass_id INT PRIMARY KEY,
	booking_id INT, -- FK
	seat VARCHAR(50),
	boarding_time TIMESTAMP,
	created_at TIMESTAMP,
	updated_at TIMESTAMP
	
);

ALTER TABLE Boarding_pass
ALTER COLUMN seat SET NOT NULL;

ALTER TABLE Boarding_pass
ADD CONSTRAINT taken_seat UNIQUE (seat);

ALTER TABLE Boarding_pass
ALTER COLUMN boarding_time SET NOT NULL;

ALTER TABLE Boarding_pass
ALTER COLUMN created_at SET NOT NULL;

ALTER TABLE Boarding_pass
ALTER COLUMN updated_at SET NOT NULL;

CREATE TABLE Booking_flight (
	booking_flight_id INT PRIMARY KEY,
	booking_id INT, -- FK
	flight_id INT, -- FK
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL
	
);

CREATE TABLE Booking (
	booking_id INT PRIMARY KEY,
	flight_id INT, -- FK
	passenger_id INT, -- FK
	booking_platform VARCHAR(50) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL,
	status VARCHAR(50) NOT NULL,
	price DECIMAL(7,2) NOT NULL
	
);

ALTER TABLE Booking
RENAME COLUMN price TO ticket_price;

CREATE TABLE Flights (
	flight_id INT PRIMARY KEY,
	airline_id INT, -- FK
	sch_departure TIMESTAMP NOT NULL,
	sch_arrival TIMESTAMP NOT NULL,
	departing_airport_id INT, -- FK
	arriving_airport_id INT, -- FK
	departing_gate VARCHAR(50) NOT NULL,
	arriving_gate VARCHAR(50) NOT NULL,
	act_departure_time TIMESTAMP,
	act_arrival_time TIMESTAMP,
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL
	
);

ALTER TABLE Flights
ALTER COLUMN departing_gate TYPE TEXT;

ALTER TABLE Flights
ALTER COLUMN arriving_gate TYPE TEXT;

CREATE TABLE Passengers (
	passenger_id INT PRIMARY KEY,
	first_name VARCHAR(50) NOT NULL,
	last_name VARCHAR(50) NOT NULL,
	date_of_birth DATE NOT NULL,
	gender VARCHAR(50) NOT NULL,
	country_of_citizenship VARCHAR(50) NOT NULL,
	country_of_residence VARCHAR(50) NOT NULL,
	passport_number VARCHAR(20) NOT NULL UNIQUE,
	created_at TIMESTAMP NOT NULL,
	updated_at  TIMESTAMP NOT NULL
	
);

CREATE TABLE Security_check (
	security_check_id INT PRIMARY KEY,
	passenger_id INT, -- FK
	result VARCHAR(20) NOT NULL,
	created_at TIMESTAMP NOT NULL,
	updated_at TIMESTAMP NOT NULL
	
);

ALTER TABLE Security_check
ADD CONSTRAINT fk_security_check_passenger_id
FOREIGN KEY (passenger_id) REFERENCES Passengers(passenger_id);

ALTER TABLE Booking
ADD CONSTRAINT fk_booking_passenger_id
FOREIGN KEY (passenger_id) REFERENCES Passengers(passenger_id);

ALTER TABLE Baggage_check
ADD CONSTRAINT fk_baggage_check_passenger_id
FOREIGN KEY (passenger_id) REFERENCES Passengers(passenger_id);



ALTER TABLE Baggage_check
ADD CONSTRAINT fk_baggage_check_booking_id
FOREIGN KEY (booking_id) REFERENCES Booking(booking_id);

ALTER TABLE Baggage
ADD CONSTRAINT fk_baggage_booking_id
FOREIGN KEY (booking_id) REFERENCES Booking(booking_id);

ALTER TABLE Boarding_pass
ADD CONSTRAINT fk_boarding_pass_booking_id
FOREIGN KEY (booking_id) REFERENCES Booking(booking_id);

ALTER TABLE Booking_flight
ADD CONSTRAINT fk_booking_flight_booking_id
FOREIGN KEY (booking_id) REFERENCES Booking(booking_id);



ALTER TABLE Booking_flight
ADD CONSTRAINT fk_booking_flight_flight_id
FOREIGN KEY (flight_id) REFERENCES Flights (flight_id);



ALTER TABLE Flights
ADD CONSTRAINT fk_flights_departing_airport_id
FOREIGN KEY (departing_airport_id) REFERENCES Airport(airport_id);

ALTER TABLE Flights
ADD CONSTRAINT fk_flights_arriving_airport_id
FOREIGN KEY (arriving_airport_id) REFERENCES Airport(airport_id);



ALTER TABLE Flights
ADD CONSTRAINT fk_flights_airline_id
FOREIGN KEY (airline_id) REFERENCES Airline(airline_id);

ALTER TABLE Baggage
ADD COLUMN baggage_size_sm VARCHAR(50) NOT NULL;